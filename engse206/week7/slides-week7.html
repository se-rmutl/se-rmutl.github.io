<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ENGSE206 - Week 7: Component Architecture Design</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #0D204E; /* RMUTL Navy Blue */
            --secondary-color: #D4A237; /* RMUTL Gold */
            --accent-color: #10B981; /* Tech Green */
            --background-gradient: linear-gradient(135deg, #0D204E 0%, #1a3a8a 100%);
            --slide-bg: rgba(255, 255, 255, 0.98);
            --text-color: #333;
            --header-color: #0D204E;
            --base-font-size: clamp(16px, 1.5vw, 24px);
            --border-radius: 15px;
            --code-font: 'Fira Code', 'Courier New', monospace;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { overflow: hidden; height: 100%; }

        body {
            font-family: 'Sarabun', sans-serif;
            background: var(--background-gradient);
            color: var(--text-color);
            font-size: 16px; 
            line-height: 1.7;
        }
        
        .presentation {
            width: 100vw;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2vh 3vw; 
        }

        .slide {
            background: var(--slide-bg);
            padding: 30px 40px 80px 40px;
            border-radius: var(--border-radius);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
            width: 100%;
            height: 100%;
            font-size: var(--base-font-size);
            overflow-y: auto;
            display: none;
            animation: fadeIn 0.5s ease-in-out;
            position: relative;
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .slide::-webkit-scrollbar { display: none; }

        .slide.active { display: block; }
        
        .title-slide.active {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            background: var(--background-gradient);
            color: white;
        }
        
        .title-slide h1, .title-slide h2, .title-slide h3, .title-slide p {
            color: white !important;
        }
        .title-slide h1 { font-size: 3em; margin-bottom: 10px; border: none;}
        .title-slide h2 { font-size: 2em; margin-bottom: 20px; border: none; }
        .title-slide h3 { font-size: 1.5em; font-weight: 400; opacity: 0.9; }


        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.98); }
            to { opacity: 1; transform: scale(1); }
        }

        .progress-bar-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 8px;
            background-color: rgba(255, 255, 255, 0.2); z-index: 2000;
        }

        .progress-bar {
            height: 100%; width: 0%;
            background: linear-gradient(120deg, var(--secondary-color) 0%, #f1c40f 100%);
            transition: width 0.3s ease-out;
        }

        .presentation-controls {
            position: fixed; bottom: 15px; left: 50%;
            transform: translateX(-50%);
            display: flex; align-items: center; gap: 10px;
            background: rgba(13, 32, 78, 0.9);
            padding: 10px 15px;
            border-radius: 50px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(8px); z-index: 1000;
        }

        .nav-btn, .font-btn, .fullscreen-btn {
            background: transparent; color: white; border: none;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex; align-items: center; justify-content: center;
            width: 45px; height: 45px;
            font-size: 1.5rem;
        }
        .nav-btn:hover:not(:disabled), .font-btn:hover, .fullscreen-btn:hover { 
            background: var(--secondary-color); 
            transform: translateY(-2px); 
        }
        .nav-btn:disabled { background-color: transparent; color: #777; cursor: not-allowed; transform: none;}
        
        #slide-counter { 
            color: white; 
            font-weight: 500; 
            font-size: 1.1em; 
            min-width: 70px;
            text-align: center; 
        }

        .slide-number {
            position: absolute; top: 15px; right: 20px;
            background: rgba(13, 32, 78, 0.8); color: white;
            padding: 5px 12px; border-radius: 15px; font-size: 0.8em; font-weight: 600;
        }
        
        .slide h2 { 
            font-size: 2.2em; 
            color: var(--header-color);
            border-bottom: 3px solid var(--secondary-color); 
            padding-bottom: 8px; 
            margin-top: 1em; 
            margin-bottom: 1em;
            font-weight: 700;
        }
        .slide h3 { 
            font-size: 1.6em; 
            color: var(--primary-color);
            margin-top: 1.5em; 
            font-weight: 700;
        }

        p, ul, ol { font-size: 1em; max-width: 85ch; }

        ul.checklist li::before {
             content: "✅"; color: var(--accent-color);
        }
        
        ul { list-style: none; padding-left: 0; }
        ul li {
            position: relative; padding-left: 30px; margin-bottom: 12px;
        }
        ul li::before {
            content: "▶"; color: var(--primary-color); position: absolute;
            left: 0; top: 0px; font-size: 1.1em;
        }
        
        pre {
            background: #2d3142; color: #e0e0e0; border-radius: 10px;
            padding: 20px; margin: 15px 0; font-family: var(--code-font);
            font-size: 0.85em; overflow-x: auto; line-height: 1.6;
        }
        code { font-family: var(--code-font); background-color: rgba(0,0,0,0.05); padding: 2px 5px; border-radius: 4px;}
        
        .solution { border-left: 4px solid var(--accent-color); background: #e8f8f5; padding: 15px; margin: 10px 0; border-radius: 0 8px 8px 0; }
        .anti-pattern { border-left: 4px solid #c0392b; background: #fdedec; padding: 15px; margin: 10px 0; border-radius: 0 8px 8px 0;}

        table {
            width: 100%; border-collapse: collapse; margin: 20px 0; 
            font-size: 0.8em; box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            border-radius: var(--border-radius);
            overflow: hidden;
        }
        table th { background: var(--header-color); color: white; padding: 12px; text-align: left; }
        table td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        table tr:nth-child(even) { background: #f9f9f9; }
        table td:first-child { font-weight: bold; }

        .mermaid-container {
            background-color: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: var(--border-radius);
            padding: 20px;
            margin-top: 20px;
            /* display: flex; */
            justify-content: center;
            align-items: center;
            min-height: 40vh;
        }
        .mermaid-container svg {
            max-width: 100%;
            height: auto;
        }
        pre.mermaid {
            background: transparent;
            text-align: center;
        }
        
        .grid-2 { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px; margin: 20px 0; align-items: stretch; }
        .grid-3 { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; align-items: stretch;}
        .grid-4 { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; align-items: stretch;}


        .infographic-card {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-top: 5px solid var(--primary-color);
            border-radius: var(--border-radius);
            padding: 25px;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
        }
        .infographic-card .icon {
            font-size: 3.5em;
            margin-bottom: 15px;
            color: var(--primary-color);
        }
        .infographic-card h4 {
            font-size: 1.2em;
            color: var(--header-color);
            margin: 0 0 10px;
        }
        .infographic-card p {
            font-size: 0.9em;
            color: #555;
            flex-grow: 1;
            text-align: left;
            width: 100%;
        }

        .timeline {
            position: relative;
            max-width: 800px;
            margin: 30px auto;
        }
        .timeline::after {
            content: '';
            position: absolute;
            width: 6px;
            background-color: #e0e0e0;
            top: 0;
            bottom: 0;
            left: 50%;
            margin-left: -3px;
        }
        .timeline-container {
            padding: 10px 40px;
            position: relative;
            background-color: inherit;
            width: 50%;
        }
        .timeline-container.left { left: 0; }
        .timeline-container.right { left: 50%; }
        .timeline-container::after {
            content: '';
            position: absolute;
            width: 25px;
            height: 25px;
            right: -17px;
            background-color: white;
            border: 4px solid var(--secondary-color);
            top: 15px;
            border-radius: 50%;
            z-index: 1;
        }
        .timeline-container.right::after { left: -14px; }
        .timeline-container.current::after {
            background-color: var(--secondary-color);
            border: 4px solid var(--accent-color);
        }
        .timeline-content {
            padding: 20px;
            background-color: white;
            position: relative;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            border-left: 5px solid var(--secondary-color);
        }
        .timeline-container.right .timeline-content {
            border-left: none;
            border-right: 5px solid var(--secondary-color);
        }
        .timeline-container.current .timeline-content {
            border-color: var(--accent-color);
            background-color: #e8f8f5;
        }
        .timeline-content h3 { font-size: 1.2em; margin-top: 0; }
        .timeline-content p { font-size: 0.9em; margin-bottom: 0; }
        
        blockquote {
            border-left: 5px solid var(--secondary-color);
            margin: 1.5em 0;
            padding: 1em 1.5em;
            background-color: #fff9e6;
            font-style: italic;
        }
        .highlight {
            background-color: var(--secondary-color);
            color: var(--primary-color);
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: bold;
        }

    </style>
</head>
<body>
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({
            startOnLoad: false, // Set to false to manually trigger rendering
            flowchart: { htmlLabels: true }
        });

        // Expose mermaid to the global scope to be accessible in the other script
        window.mermaid = mermaid;
    </script>

    <div class="progress-bar-container">
        <div class="progress-bar" id="progress-bar"></div>
    </div>

    <div class="presentation">

        <section class="slide title-slide active">
            <h2>ENGSE206: Software Requirements Specification and Design</h2>
            <h1>สัปดาห์ที่ 7: Component Architecture (C3)</h1>
            <h3 style="margin-top: 30px;">การออกแบบสถาปัตยกรรมส่วนประกอบภายใน </h3>
            <p style="font-size: 1.2em; opacity: 0.9;">มหาวิทยาลัยเทคโนโลยีราชมงคลล้านนา (ดอยสะเก็ด)</p>
            <div class="slide-number">1/40</div>
        </section>

        <section class="slide">
            <h2>🎯 วัตถุประสงค์และเป้าหมายการเรียนรู้</h2>
            <div class="grid-3">
                <div class="infographic-card">
                    <div class="icon">📚</div>
                    <h4>วัตถุประสงค์</h4>
                    <p>
                        <ul>
                            <li>สร้าง C3 (Component) Diagram</li>
                            <li>ออกแบบ Component Interface</li>
                            <li>เข้าใจ Component Design Principles</li>
                        </ul>
                    </p>
                </div>
                <div class="infographic-card" style="border-top-color: var(--secondary-color);">
                    <div class="icon">🎯</div>
                    <h4>เป้าหมายการเรียนรู้</h4>
                     <p>
                        <ul>
                            <li>วิเคราะห์และแบ่ง Components</li>
                            <li>ออกแบบ Interface ที่มีประสิทธิภาพ</li>
                            <li>ประยุกต์ใช้ Design Patterns</li>
                        </ul>
                    </p>
                </div>
                <div class="infographic-card" style="border-top-color: var(--accent-color);">
                    <div class="icon">📊</div>
                    <h4>ผลที่คาดหวัง</h4>
                     <p>
                        <ul>
                            <li>ได้ C3 Diagram ที่สมบูรณ์</li>
                            <li>ได้เอกสาร Interface Specs ที่ชัดเจน</li>
                            <li>พร้อมสำหรับ Implementation</li>
                        </ul>
                    </p>
                </div>
            </div>
            <div class="slide-number">2/40</div>
        </section>

        <section class="slide">
            <h2>📚 ทบทวน & เชื่อมโยงบทเรียน</h2>
            <div class="timeline">
                <div class="timeline-container left">
                    <div class="timeline-content">
                        <h3>สัปดาห์ที่ 5: High-Level Architecture</h3>
                        <p>เรียนรู้ 3-Tier Arch, SOLID และสร้าง C4 Model <br>(C1-Context & C2-Container)</p>
                    </div>
                </div>
                <div class="timeline-container right">
                    <div class="timeline-content">
                        <h3>สัปดาห์ที่ 6: Design Patterns</h3>
                        <p>ศึกษา Patterns สำคัญ เช่น Observer, Facade, Singleton, Strategy, Pub-Sub</p>
                    </div>
                </div>
                <div class="timeline-container left current">
                    <div class="timeline-content">
                        <h3><strong>สัปดาห์นี้ (ที่ 7): Component Arch</strong></h3>
                        <p><strong>เจาะลึก C4 (C3-Component), หลักการ Cohesion & Coupling, Interface Design</strong></p>
                    </div>
                </div>
                <div class="timeline-container right">
                    <div class="timeline-content">
                        <h3>ต่อไปสัปดาห์ที่ 8: Implementation Ready</h3>
                        <p>ลงรายละเอียดระดับ Code (C4-Code), UML Diagrams และ API Specs</p>
                    </div>
                </div>
            </div>
            <div class="slide-number">3/40</div>
        </section>

        <section class="slide">
            <h2>🧩 Component คืออะไร?</h2>
            <blockquote>💡 <strong>Component</strong> คือหน่วยย่อยของซอฟต์แวร์ที่ทำงานได้ค่อนข้างอิสระและมีหน้าที่รับผิดชอบที่เฉพาะเจาะจง เปรียบเสมือน "ห้องต่างๆ" ในบ้าน (System) ที่แต่ละห้องมีหน้าที่ของตัวเอง แต่ทำงานร่วมกันเป็นบ้านที่สมบูรณ์</blockquote>
            <h3>📦 ลักษณะของ Component ที่ดี</h3>
            <div class="grid-4">
                <div class="infographic-card">
                    <div class="icon">⚙️</div>
                    <h4>High Cohesion</h4>
                    <p>ส่วนต่างๆ ภายในทำงานร่วมกันอย่างสอดคล้องเพื่อเป้าหมายเดียว</p>
                </div>
                <div class="infographic-card">
                    <div class="icon">🔗</div>
                    <h4>Loose Coupling</h4>
                    <p>พึ่งพากันน้อยที่สุด เปลี่ยนแปลงหนึ่งส่วนไม่กระทบส่วนอื่นมากนัก</p>
                </div>
                <div class="infographic-card">
                    <div class="icon">🚪</div>
                    <h4>Clear Interface</h4>
                    <p>มี "ประตู" หรือ API ที่ชัดเจนสำหรับสื่อสาร และซ่อนความซับซ้อนไว้ภายใน (Encapsulation)</p>
                </div>
                <div class="infographic-card">
                    <div class="icon">♻️</div>
                    <h4>Reusability</h4>
                    <p>สามารถออกแบบให้นำกลับมาใช้ใหม่ได้ในโปรเจกต์หรือบริบทอื่นๆ</p>
                </div>
            </div>
            <div class="slide-number">4/40</div>
        </section>

        <section class="slide">
            <h2>🔄 จาก Design Patterns สู่ Components</h2>
            <h3>การนำ Patterns มาใช้ในการออกแบบ Components</h3>
            <div class="grid-2">
                <div>
                    <h4>ตัวอย่างการแปลง Patterns เป็น Components:</h4>
                    <ul>
                        <li><strong>Singleton Pattern</strong> → <code>WebSocket Connection Manager</code> Component</li>
                        <li><strong>Adapter Pattern</strong> → <code>Database Adapter</code> Component</li>
                        <li><strong>Observer Pattern</strong> → <code>Event Broadcasting</code> Component</li>
                        <li><strong>Facade Pattern</strong> → <code>Dashboard API Facade</code> Component</li>
                         <li><strong>Publisher-Subscriber</strong> → <code>Event Bus</code> Component</li>
                    </ul>
                </div>
                <div class="mermaid-container">
                    <pre class="mermaid">
                    graph TD
                        A["Design Patterns<br/>(Observer, Facade, Singleton, etc.)"] --> B{นำมาสร้างเป็น};
                        subgraph Components
                            C1[WebSocket Manager]
                            C2[Dashboard API]
                            C3[Event Broadcasting]
                            C4[Database Adapter]
                        end
                        B --> C1 & C2 & C3 & C4;
                    </pre>
                </div>
            </div>
            <blockquote style="margin-top: 20px;">🎯 <strong>Pattern</strong> คือ "วิธีการ" → <strong>Component</strong> คือ "หน่วยการทำงาน" → <strong>Architecture</strong> คือ "การจัดเรียง"</blockquote>
            <div class="slide-number">5/40</div>
        </section>
        
        <section class="slide">
            <h2>🏢 C4 Model Level 3 - Component Diagram</h2>
            <h3>จาก Container สู่ Component</h3>
            
            <div class="grid-2">
                <div>
                    <h4>C4 Model Recap:</h4>
                    <ul>
                        <li><strong>C1 (Context):</strong> ภาพรวมที่สุด</li>
                        <li><strong>C2 (Container):</strong> ส่วนประกอบหลัก (App, API, DB)</li>
                        <li><strong>C3 (Component):</strong> <span class="highlight">← เราอยู่ตรงนี้</span></li>
                        <li><strong>C4 (Code):</strong> Class/Function (สัปดาห์หน้า)</li>
                    </ul>
                     <h4>📈 ความสำคัญของ C3</h4>
                    <ul>
                        <li><strong>Developers:</strong> เป็นแผนที่ในการพัฒนาและแบ่งงาน</li>
                        <li><strong>Architects:</strong> ช่วยตรวจสอบความถูกต้องของ Design</li>
                        <li><strong>Team Leads:</strong> ช่วยวางแผนการทำงานและจัดสรรคน</li>
                         <li><strong>QA:</strong> ช่วยในการวางแผน Test</li>
                    </ul>
                </div>
                 <div class="mermaid-container">
                    <pre class="mermaid">
                    graph TD
                        C1["System Context"] --> C2["Containers"]
                        C2 --> C3["Components"]
                        C3 --> C4["Code"]
                        style C3 fill:#D4A237,stroke:#333,stroke-width:2px,color:white
                    </pre>
                </div>
            </div>
             <div class="slide-number">6/40</div>
        </section>

        <section class="slide">
            <h2>🖥️ Frontend Components - Agent Desktop App</h2>
            <h3>Components ภายใน Desktop Application (Electron.js)</h3>
            <div class="grid-3">
                 <div class="infographic-card">
                    <h4>🔐 Authentication</h4>
                    <p><b>หน้าที่:</b> จัดการ Login/Logout<br/><b>Pattern:</b> Strategy<br/><b>Dependencies:</b> Auth API, Session Mgr</p>
                </div>
                <div class="infographic-card">
                    <h4>📊 Status Management</h4>
                    <p><b>หน้าที่:</b> จัดการสถานะ Agent<br/><b>Pattern:</b> Observer<br/><b>Dependencies:</b> Agent API, WebSocket</p>
                </div>
                <div class="infographic-card">
                    <h4>🔔 Real-time Notification</h4>
                    <p><b>หน้าที่:</b> รับและแสดง notifications<br/><b>Pattern:</b> Observer, Pub-Sub<br/><b>Dependencies:</b> WebSocket</p>
                </div>
                <div class="infographic-card">
                    <h4>👤 Profile Management</h4>
                    <p><b>หน้าที่:</b> จัดการข้อมูลส่วนตัว<br/><b>Dependencies:</b> Agent API, Local Storage</p>
                </div>
                <div class="infographic-card">
                    <h4>💬 Message Display</h4>
                    <p><b>หน้าที่:</b> แสดงข้อความจาก Supervisor<br/><b>Dependencies:</b> Message API, WebSocket</p>
                </div>
            </div>
             <div class="slide-number">7/40</div>
        </section>
        
        <section class="slide">
            <h2>🖥️ Frontend Components - Supervisor Dashboard</h2>
             <h3>Components ภายใน Supervisor Web Dashboard</h3>
            <div class="grid-3">
                 <div class="infographic-card">
                    <h4>📈 Dashboard Visualization</h4>
                    <p><b>หน้าที่:</b> แสดงภาพรวมสถานะ Agents<br/><b>Pattern:</b> Observer, Facade<br/><b>Dependencies:</b> Dashboard API, WebSocket</p>
                </div>
                <div class="infographic-card">
                    <h4>👥 Agent Monitor</h4>
                    <p><b>หน้าที่:</b> ติดตาม Agent รายบุคคล<br/><b>Pattern:</b> Observer<br/><b>Dependencies:</b> Agent API, WebSocket</p>
                </div>
                <div class="infographic-card">
                    <h4>📨 Message Management</h4>
                    <p><b>หน้าที่:</b> ส่งข้อความถึง Agents<br/><b>Pattern:</b> Command, Factory<br/><b>Dependencies:</b> Message API</p>
                </div>
                <div class="infographic-card">
                    <h4>📄 Reports Component</h4>
                    <p><b>หน้าที่:</b> สร้างและแสดงรายงาน<br/><b>Pattern:</b> Strategy, Factory<br/><b>Dependencies:</b> Reporting API</p>
                </div>
                 <div class="infographic-card">
                    <h4>🎛️ Control Panel</h4>
                    <p><b>หน้าที่:</b> ควบคุมการตั้งค่าทีม<br/><b>Dependencies:</b> Admin API, Settings</p>
                </div>
            </div>
             <div class="slide-number">8/40</div>
        </section>

        <section class="slide">
            <h2>⚙️ Backend Components - API Server</h2>
            <h3>Components ภายใน Node.js API Server</h3>
             <div class="grid-3">
                 <div class="infographic-card">
                    <h4>🔑 Authentication Service</h4>
                    <p><b>หน้าที่:</b> ตรวจสอบ credentials, สร้าง sessions<br/><b>Pattern:</b> Strategy, Singleton<br/><b>Dependencies:</b> DB Adapter, JWT</p>
                </div>
                <div class="infographic-card">
                    <h4>🚦 Agent Status Service</h4>
                    <p><b>หน้าที่:</b> จัดการสถานะ Agents<br/><b>Pattern:</b> Observer, Command<br/><b>Dependencies:</b> DB Adapter, Event Bus</p>
                </div>
                <div class="infographic-card">
                    <h4>📮 Message Routing Service</h4>
                    <p><b>หน้าที่:</b> จัดส่งข้อความ<br/><b>Pattern:</b> Factory, Pub-Sub<br/><b>Dependencies:</b> DB Adapter, WebSocket Mgr</p>
                </div>
                <div class="infographic-card">
                    <h4>🔌 WebSocket Manager</h4>
                    <p><b>หน้าที่:</b> จัดการ WebSocket connections<br/><b>Pattern:</b> Singleton, Observer<br/><b>Dependencies:</b> Socket.IO, Event Bus</p>
                </div>
                <div class="infographic-card">
                    <h4>💾 Database Access Layer</h4>
                    <p><b>หน้าที่:</b> เชื่อมต่อและจัดการข้อมูล<br/><b>Pattern:</b> Adapter, Factory<br/><b>Dependencies:</b> DB Drivers, Circuit Breaker</p>
                </div>
            </div>
             <div class="slide-number">9/40</div>
        </section>
        
        <section class="slide">
            <h2>🗄️ Data Tier Components</h2>
            <h3>Components ภายใน Database Layer</h3>
            <div class="grid-3">
                 <div class="infographic-card">
                    <h4>🗃️ MSSQL Component</h4>
                    <p><b>หน้าที่:</b> จัดการ structured master data (Agents, Teams, Users).<br/><b>Pattern:</b> Repository, Unit of Work.</p>
                </div>
                <div class="infographic-card">
                    <h4>🍃 MongoDB Component</h4>
                    <p><b>หน้าที่:</b> จัดการ real-time และ log data (Status Logs, Messages).<br/><b>Pattern:</b> Repository, Document Mapper.</p>
                </div>
                <div class="infographic-card">
                    <h4>🔄 Data Synchronization</h4>
                    <p><b>หน้าที่:</b> ประสานข้อมูลระหว่าง MSSQL และ MongoDB.<br/><b>Pattern:</b> Adapter, Observer.</p>
                </div>
                 <div class="infographic-card">
                    <h4>🏊 Connection Pool Manager</h4>
                    <p><b>หน้าที่:</b> จัดการ database connections.<br/><b>Pattern:</b> Singleton, Object Pool.</p>
                </div>
                 <div class="infographic-card">
                    <h4>🛡️ Data Security Component</h4>
                    <p><b>หน้าที่:</b> เข้ารหัสและป้องกันข้อมูล<br/><b>Pattern:</b> Strategy, Decorator</p>
                </div>
            </div>
             <div class="slide-number">10/40</div>
        </section>
        
        <section class="slide">
            <h2>🔗 Component Dependencies</h2>
            <div class="grid-2">
                <div>
                    <h4>High-Level Dependencies:</h4>
                     <div class="mermaid-container">
                        <pre class="mermaid">
                        graph TD
                            A[Frontend Components] -->|HTTP / WebSocket| B[Backend API Components]
                            B -->|Database Queries| C[Data Tier Components]
                        </pre>
                    </div>
                </div>
                <div>
                    <h4>⚠️ ปัญหาที่อาจเกิดขึ้น:</h4>
                    <ul>
                        <li><strong>Circular Dependencies:</strong> A เรียก B, B เรียก A</li>
                        <li><strong>Too Many Dependencies:</strong> ซับซ้อนเกินไป</li>
                        <li><strong>Wrong Direction:</strong> Layer ล่างเรียก Layer บน</li>
                    </ul>
                    <h4>✅ Best Practices:</h4>
                     <ul class="checklist">
                        <li>Dependency Injection</li>
                        <li>Interface Segregation</li>
                        <li>Layered Dependencies</li>
                    </ul>
                </div>
            </div>
             <div class="slide-number">11/40</div>
        </section>

        <section class="slide">
            <h2>🏗️ Principle: High Cohesion</h2>
            <blockquote>💡 ส่วนประกอบต่างๆ ภายใน Component เดียวกัน ควรจะทำงานเกี่ยวเนื่องกันอย่างใกล้ชิดเพื่อเป้าหมายเดียว</blockquote>
            <div class="grid-2">
                <div class="solution">
                    <h4>✅ High Cohesion Example</h4>
                    <pre><code class="language-javascript">
class AuthenticationComponent {
  // ทุกอย่างเกี่ยวกับการ Auth
  login(credentials) {/**/}
  logout() {/**/}
  validateSession() {/**/}
  refreshToken() {/**/}
  getCurrentUser() {/**/}
}
</code></pre>
                    <p><strong>ดีอย่างไร?</strong>: มีเป้าหมายเดียว ทำให้เข้าใจ, แก้ไข, และทดสอบง่าย</p>
                </div>
                 <div class="anti-pattern">
                    <h4>❌ Low Cohesion Example</h4>
                    <pre><code class="language-javascript">
class MixedComponent {
  login(credentials) {/**/}      // Auth
  sendMessage(message) {/**/}     // Messaging
  generateReport() {/**/}        // Reporting
  connectDatabase() {/**/}       // Database
}
</code></pre>
                    <p><strong>ปัญหาคืออะไร?</strong>: ทำหลายอย่างเกินไป (จับฉ่าย) แก้ไขส่วนหนึ่งอาจกระทบส่วนอื่น</p>
                </div>
            </div>
             <div class="slide-number">12/40</div>
        </section>

        <section class="slide">
            <h2>🔗 Principle: Loose Coupling</h2>
            <blockquote>💡 Components ควรจะพึ่งพากันและกันให้น้อยที่สุด การเปลี่ยนแปลงใน Component หนึ่ง ไม่ควรส่งผลกระทบเป็นลูกโซ่ไปยัง Component อื่นๆ</blockquote>
             <div class="grid-2">
                <div class="solution">
                    <h4>✅ Loose Coupling Example</h4>
                    <pre><code class="language-javascript">
// ไม่ต้องรู้ว่าเป็น DB อะไร คุยผ่าน Adapter
class AuthService {
  constructor(databaseAdapter) { // DI
    this.db = databaseAdapter;
  }
  
  async auth(cred) {
    // ใช้ interface, ไม่สนว่าเป็น MSSQL หรือ Mongo
    return await this.db.findUser(cred.username);
  }
}
</code></pre>
                    <p><strong>ดีอย่างไร?</strong>: เปลี่ยน DB ได้โดยไม่ต้องแก้ AuthService เลย</p>
                </div>
                 <div class="anti-pattern">
                    <h4>❌ Tight Coupling Example</h4>
                    <pre><code class="language-javascript">
class AuthService {
  async auth(cred) {
    // ผูกติดกับ MSSQL โดยตรง!
    const conn = new MSSQL.connect('server=...');
    const result = await conn.query(`...`);
    // ถ้าเปลี่ยน DB ต้องรื้อโค้ดนี้ทั้งหมด
  }
}
</code></pre>
                    <p><strong>ปัญหาคืออะไร?</strong>: โค้ดผูกมัดกับเทคโนโลยีแน่นหนา ทำให้เปลี่ยนได้ยาก</p>
                </div>
            </div>
             <div class="slide-number">13/40</div>
        </section>

        <section class="slide">
            <h2>🔌 Principle: Interface Segregation</h2>
             <blockquote>💡 แบ่ง Interface (สัญญาการใช้งาน) ให้เล็กและเฉพาะเจาะจงตามหน้าที่ ไม่บังคับให้ Component ใช้งาน Method ที่ไม่ต้องการ</blockquote>
             <div class="grid-2">
                <div class="solution">
                    <h4>✅ Good Example</h4>
                    <pre><code class="language-javascript">
// แบ่ง Interface ตามหน้าที่
interface UserReader { getUser(id); }
interface UserWriter { createUser(user); }
interface UserAuthenticator { authenticate(cred); }

// Dashboard ใช้แค่การอ่าน, ปลอดภัยกว่า
class DashboardComponent implements UserReader {/**/}

// Admin ใช้ทั้งอ่านและเขียน
class AdminComponent implements UserReader, UserWriter {/**/}
</code></pre>
                </div>
                 <div class="anti-pattern">
                    <h4>❌ Bad Example (Fat Interface)</h4>
                    <pre><code class="language-javascript">
interface IUserManager {
  getUser(id);
  createUser(user);
  deleteUser(id);
  authenticate(cred);
  generateReport();
  // ... อีก 10 methods ที่ไม่เกี่ยวกับ Dashboard
}

// Dashboard ถูกบังคับให้รู้จักทุก method
class DashboardComponent implements IUserManager {
    // ต้อง implement method ที่ไม่ได้ใช้
    createUser() { throw new Error("Not supported"); }
}
</code></pre>
                </div>
            </div>
             <div class="slide-number">14/40</div>
        </section>

        <section class="slide">
            <h2>💉 Dependency Injection (DI) Patterns</h2>
            <blockquote>💡 คือการส่ง "สิ่งที่ Component ต้องการใช้" (Dependencies) เข้าไปจากภายนอก แทนที่จะให้ Component สร้างสิ่งเหล่านั้นขึ้นมาเองภายใน</blockquote>
             <div class="grid-3">
                <div>
                    <h4>1. Constructor Injection</h4>
                    <p>ส่ง Dependencies เข้าไปตอนที่สร้าง Object (นิยมที่สุด)</p>
                    <pre><code class="language-javascript">
class AgentStatusService {
  constructor(db, eventBus, logger) {
    this.db = db;
    this.eventBus = eventBus;
    this.logger = logger;
  }
}
</code></pre>
                </div>
                <div>
                     <h4>2. Method Injection</h4>
                    <p>ส่ง Dependency เข้าไปเป็น Parameter ของ Method</p>
                    <pre><code class="language-javascript">
class MessageService {
  sendMessage(msg, sender) {
    return sender.send(msg);
  }
}
</code></pre>
                </div>
                <div>
                     <h4>3. Property Injection</h4>
                    <p>กำหนดค่า Property จากภายนอกหลังสร้าง Object</p>
                    <pre><code class="language-javascript">
class Dashboard {
  // Properties ที่จะ inject
  dataService: DataService;
  chartLibrary: ChartLibrary;
}
</code></pre>
                </div>
            </div>
             <div class="slide-number">15/40</div>
        </section>
        
        <section class="slide">
            <h2>🔄 Component Communication Patterns</h2>
            <div class="grid-4">
                <div class="infographic-card">
                    <h4>📞 Direct Method Calls</h4>
                    <p><b>การใช้งาน:</b> เรียกใช้โดยตรง<br/><b>เหมาะกับ:</b> งานที่ต้องการผลลัพธ์ทันที (Synchronous)<br/><b>ตัวอย่าง:</b> <code>apiClient.post(...)</code></p>
                </div>
                <div class="infographic-card">
                    <h4>🔔 Event-Driven</h4>
                    <p><b>การใช้งาน:</b> ประกาศ Event และมีผู้ติดตาม (Subscribe)<br/><b>เหมาะกับ:</b> Real-time updates, Decoupling<br/><b>ตัวอย่าง:</b> <code>eventBus.publish(...)</code></p>
                </div>
                <div class="infographic-card">
                    <h4>📨 Message Passing</h4>
                    <p><b>การใช้งาน:</b> ส่งงานเข้าคิว (Queue)<br/><b>เหมาะกับ:</b> งาน Background (Asynchronous)<br/><b>ตัวอย่าง:</b> <code>messageQueue.enqueue(...)</code></p>
                </div>
                <div class="infographic-card">
                    <h4>🌐 WebSocket</h4>
                    <p><b>การใช้งาน:</b> สื่อสารสองทิศทาง<br/><b>เหมาะกับ:</b> Live data, Real-time dashboards<br/><b>ตัวอย่าง:</b> <code>socket.emit(...)</code></p>
                </div>
            </div>
             <div class="slide-number">16/40</div>
        </section>

        <section class="slide">
            <h2>🏛️ Event-Driven Architecture</h2>
            <blockquote>💡 สถาปัตยกรรมที่ใช้ "เหตุการณ์" (Events) เป็นหัวใจหลักในการสื่อสารระหว่างส่วนต่างๆ ของระบบ</blockquote>
            
            <h4>Flow การทำงานใน Agent Wallboard System:</h4>
             <div class="mermaid-container">
                <pre class="mermaid">
                sequenceDiagram
                    participant Agent
                    participant StatusService as "Agent Status Service"
                    participant EventBus
                    participant Dashboard as "Dashboard Component"
                    participant Notifier as "Notification Service"
                    
                    Agent->>StatusService: เปลี่ยนสถานะ
                    StatusService->>StatusService: อัพเดท DB
                    StatusService->>EventBus: Publish('status_changed')
                    EventBus-->>Dashboard: Notify
                    EventBus-->>Notifier: Notify
                </pre>
            </div>
            
            <h4>✅ ประโยชน์: Decoupling, Scalability, Real-time, Flexibility</h4>
             <div class="slide-number">17/40</div>
        </section>

        <section class="slide">
            <h2>🚪 API Gateway Pattern</h2>
            <blockquote>💡 "ประตูหน้าด่าน" เพียงจุดเดียวที่ Client จากภายนอกจะติดต่อเข้ามา แทนที่จะต้องติดต่อกับ Service ต่างๆ ภายในโดยตรง</blockquote>
            <div class="grid-2">
                <div>
                    <h4>🎯 หน้าที่ของ API Gateway:</h4>
                    <ul class="checklist">
                        <li>Authentication & Authorization</li>
                        <li>Request Routing & Load Balancing</li>
                        <li>Rate Limiting & Caching</li>
                        <li>Logging & Monitoring</li>
                        <li>Response Aggregation (รวมข้อมูลจากหลาย Service)</li>
                    </ul>
                </div>
                 <div class="mermaid-container">
                    <pre class="mermaid">
                    graph TD
                        subgraph Clients
                            A[Mobile App]
                            B[Web App]
                        end
                        subgraph "Backend Services"
                            S1[Auth Service]
                            S2[Agent Service]
                            S3[Message Service]
                        end
                        GW[API Gateway]
                        
                        A --> GW
                        B --> GW
                        GW --> S1 & S2 & S3
                    </pre>
                </div>
            </div>
             <div class="slide-number">18/40</div>
        </section>
        
        <section class="slide">
            <h2>📊 CQRS Pattern</h2>
            <blockquote>💡 <strong>CQRS (Command Query Responsibility Segregation)</strong> คือหลักการที่แยก Model สำหรับการเปลี่ยนแปลงข้อมูล (Command) ออกจาก Model สำหรับการดึงข้อมูลไปแสดงผล (Query) อย่างชัดเจน</blockquote>
            <div class="grid-2">
                <div class="solution">
                    <h4>Command Side (ฝั่งเขียน)</h4>
                    <p><b>ตัวอย่าง:</b> Agent เปลี่ยนสถานะ</p>
                    <ul>
                        <li>เน้นความถูกต้องของข้อมูล (Consistency)</li>
                        <li>ใช้ DB หลัก (เช่น MSSQL) ที่มี Transaction</li>
                        <li>Logic ซับซ้อนได้</li>
                    </ul>
                </div>
                <div class="solution">
                     <h4>Query Side (ฝั่งอ่าน)</h4>
                    <p><b>ตัวอย่าง:</b> Supervisor ดู Dashboard</p>
                    <ul>
                        <li>เน้นความรวดเร็ว (Performance)</li>
                        <li>ใช้ DB สำหรับอ่านโดยเฉพาะ (เช่น MongoDB, Redis Cache) ที่ปรับโครงสร้างมาเพื่อการ Query</li>
                    </ul>
                </div>
            </div>
            <div class="anti-pattern" style="margin-top: 20px;"><strong>ข้อควรระวัง:</strong> เพิ่มความซับซ้อน และข้อมูลฝั่งอ่านอาจจะช้ากว่าฝั่งเขียนเล็กน้อย (Eventual Consistency)</div>
             <div class="slide-number">19/40</div>
        </section>

                <section id="slide-19" class="slide">
            <h2>🔧 Component Interface Design</h2>
            <blockquote>💡 <strong>Interface</strong> คือ "สัญญา" ที่กำหนดว่า Component ทำอะไรได้บ้าง โดยไม่ต้องสนใจว่า "ทำอย่างไร"</blockquote>

            <h4>หลักการออกแบบ Interface ที่ดี:</h4>
            <div class="grid-2">
                 <div class="infographic-card">
                    <div class="icon">🏷️</div>
                    <h4>Clear Naming</h4>
                    <p>ตั้งชื่อให้ชัดเจนและสื่อความหมาย (<code>getCurrentStatus</code> vs <code>get</code>)</p>
                </div>
                 <div class="infographic-card">
                    <div class="icon">🎯</div>
                    <h4>Single Responsibility</h4>
                    <p>Interface หนึ่งควรรับผิดชอบหน้าที่หลักเพียงอย่างเดียว</p>
                </div>
                 <div class="infographic-card">
                    <div class="icon">🚦</div>
                    <h4>Consistent Errors</h4>
                    <p>มีรูปแบบการจัดการ Error ที่เป็นมาตรฐานเดียวกัน</p>
                </div>
                <div class="infographic-card">
                    <div class="icon">🗓️</div>
                    <h4>Versioning</h4>
                    <p>มีการวางแผนสำหรับเวอร์ชันในอนาคต (v1, v2)</p>
                </div>
            </div>
             <div class="slide-number">20/41</div>
        </section>
        
        <section class="slide">
            <h2>🔧 Component Interface Design</h2>
            <blockquote>💡 <strong>Interface</strong> คือ "สัญญา" ที่กำหนดว่า Component ทำอะไรได้บ้าง โดยไม่ต้องสนใจว่า "ทำอย่างไร"</blockquote>
            <h4>หลักการออกแบบ Interface ที่ดี:</h4>
            <div class="grid-2">
                 <div>
                    <h4>✅ Good Naming & Single Responsibility</h4>
                    <pre><code class="language-typescript">
interface AgentStatusService {
  getCurrentStatus(agentId: string);
  updateStatus(agentId: string, status: StatusType);
}</code></pre>
                </div>
                <div>
                    <h4>❌ Poor Naming & Mixed Responsibilities</h4>
                    <pre><code class="language-typescript">
interface Manager {
  get(id: string);
  set(id: string, data: any);
  generateReport(); // Unrelated
}</code></pre>
                </div>
            </div>
            <p style="margin-top: 1em;">หลักการอื่น ๆ: <strong>Consistent Errors</strong> (มีรูปแบบ Error ที่เป็นมาตรฐาน), <strong>Versioning</strong> (วางแผนสำหรับ v1, v2)</p>
             <div class="slide-number">20/40</div>
        </section>

        <section class="slide">
            <h2>✅ Interface Design Best Practices</h2>
            <div class="grid-2">
                 <div>
                    <h4>1. Use TypeScript/Strong Typing</h4>
                    <pre><code class="language-typescript">
type AgentStatusType = 
    | 'Available' | 'Busy' | 'Away';

interface StatusUpdateRequest {
  agentId: string;
  newStatus: AgentStatusType;
  reason?: string;
}
</code></pre>
                </div>
                 <div>
                    <h4>2. Design for Extensibility</h4>
                    <pre><code class="language-typescript">
// ใช้ Union type
type Message = 
    | ChatMessage 
    | SystemAlert 
    | StatusNotification;
</code></pre>
                </div>
                <div>
                    <h4>3. Include Metadata & Context</h4>
                    <pre><code class="language-typescript">
interface ServiceResponse<T> {
  data: T;
  metadata: { 
    requestId: string, 
    timestamp: Date 
  };
}
</code></pre>
                </div>
                <div>
                    <h4>4. Custom Error Types</h4>
                    <pre><code class="language-typescript">
class ValidationError extends Error {}
class BusinessRuleError extends Error {}

type Result<T, E> = 
    | { success: true; data: T } 
    | { success: false; error: E };
</code></pre>
                </div>
            </div>
             <div class="slide-number">21/40</div>
        </section>

        <section class="slide">
            <h2>🎨 สร้าง C3 Component Diagram</h2>
             <h3>ขั้นตอนการสร้าง</h3>
             <div class="timeline">
                <div class="timeline-container left current">
                    <div class="timeline-content">
                        <h3>Step 1: Identify Components</h3>
                        <p>ลิสต์ Components ทั้งหมดในแต่ละ Container</p>
                    </div>
                </div>
                <div class="timeline-container right current">
                    <div class="timeline-content">
                        <h3>Step 2: Define Interfaces</h3>
                        <p>กำหนด "ประตู" หรือ API ที่ใช้สื่อสารระหว่างกัน</p>
                    </div>
                </div>
                <div class="timeline-container left current">
                    <div class="timeline-content">
                        <h3>Step 3: Show Dependencies</h3>
                        <p>วาดเส้นเชื่อมโยงและทิศทางการไหลของข้อมูล</p>
                    </div>
                </div>
                 <div class="timeline-container right current">
                    <div class="timeline-content">
                        <h3>Step 4: Add Tech Details</h3>
                        <p>เพิ่มข้อมูล Protocol (HTTP, WS) และ Data Format (JSON)</p>
                    </div>
                </div>
            </div>
             <div class="slide-number">22/40</div>
        </section>

        <section class="slide">
            <h2>📊 C3 Diagram - Desktop App Components</h2>
            <div class="mermaid-container">
                <pre><code style="font-size: 0.8em; text-align: left; line-height: 1.2;">
┌─────────────────────────────────────────────────┐
│               Desktop Application               │
│                 (Electron.js)                   │
│ ┌─────────────────┐    ┌───────────────────────┐│
│ │  Authentication │    │   Status Management   ││
│ │   Component     │◄──►│     Component         ││  
│ │• login()        │    │• changeStatus()       ││
│ │• logout()       │    │• getCurrentStatus()   ││
│ └─────────────────┘    └───────────────────────┘│
│           │                        │            │
│           │            ┌───────────────────────┐│
│           └───────────►│      Notification     ││
│                        │      Component        ││
│ ┌─────────────────┐    │• showAlert()          ││
│ │   WebSocket     │◄──►│• displayMessage()     ││
│ │ Client Component│    │• updateStatus()       ││
│ │                 │    └───────────────────────┘│
│ │• connect()      │               │             │
│ │• subscribe()    │    ┌───────────────────────┐│
│ │• emit()         │    │   Profile Component   ││
│ └─────────────────┘◄──►│                       ││
│           │            │• getProfile()         ││
│           │            │• updatePreferences()  ││
│           │            └───────────────────────┘│
│           ▼ WebSocket/HTTPS                     │
└─────────────────────────────────────────────────┘
                </code></pre>
            </div>
             <div class="slide-number">23/40</div>
        </section>

                <section id="slide-22" class="slide">
            <h2>📊 C3 Diagram - Desktop App Components</h2>
            <div class="mermaid-container">
                <pre class="mermaid">
                graph TD
                    subgraph Desktop_Application ["Desktop Application (Electron.js)"]
                        Auth["Authentication<br/>Component"]
                        Status["Status Management"]
                        Notify["Notification<br/>Component"]
                        WSClient["WebSocket Client"]
                        Profile["Profile<br/>Component"]
                    end

                    APIServer((API Server))

                    Auth -- HTTP --> APIServer
                    Status -- HTTP --> APIServer
                    Profile -- HTTP --> APIServer
                    WSClient -- WebSocket --> APIServer

                    WSClient <--> Notify
                    Auth --- Status
                </pre>
            </div>
             <div class="slide-number">23/41</div>
        </section>

        <section class="slide">
            <h2>📊 C3 Diagram - Supervisor Dashboard Components</h2>
             <div class="mermaid-container">
                <pre><code style="font-size: 0.8em; text-align: left; line-height: 1.2;">
┌─────────────────────────────────────────────────┐
│            Supervisor Dashboard                 │
│               (React.js Web)                    │
│ ┌─────────────────┐    ┌───────────────────────┐│
│ │   Dashboard     │◄──►│   Agent Monitor       ││
│ │ Visualization   │    │    Component          ││
│ │• renderCharts() │    │• getTeamStatus()      ││
│ │• updateMetrics()│    │• sendMessage()        ││
│ └─────────────────┘    └───────────────────────┘│
│           │                        │            │
│           │            ┌───────────────────────┐│
│           └───────────►│    Message Mgmt       ││
│ ┌─────────────────┐    │• sendIndividual()     ││
│ │    Reports      │◄──►│• broadcast()          ││
│ │   Component     │    └───────────────────────┘│
│ │• generateKPI()  │               │             │
│ │• exportPDF()    │    ┌───────────────────────┐│
│ └─────────────────┘    │   Control Panel       ││
│           │◄──────────►│• teamSettings()       ││
│ ┌─────────────────┐    │• manageAgents()       ││
│ │   WebSocket     │◄───┘• auditLogs()          ││
│ │ Client Component│    └───────────────────────┘│
│ │• subscribeTeam()│                             │
│ └─────────────────┘                             │
│           ▼ WebSocket/HTTPS                     │
└─────────────────────────────────────────────────┘
                </code></pre>
            </div>
             <div class="slide-number">24/40</div>
        </section>

                <section id="slide-23" class="slide">
            <h2>📊 C3 Diagram - Supervisor Dashboard Components</h2>
            <div class="mermaid-container">
                 <pre class="mermaid">
                graph TD
                    subgraph Supervisor_Dashboard ["Supervisor Dashboard (Web)"]
                        Dashboard["Dashboard<br/>Visualization"]
                        Monitor["Agent Monitor"]
                        Messaging["Message<br/>Management"]
                        Reports["Reports Component"]
                        WSClient["WebSocket Client"]
                    end

                    APIServer((API Server))
                    
                    Dashboard -- HTTP --> APIServer
                    Monitor -- HTTP --> APIServer
                    Messaging -- HTTP --> APIServer
                    Reports -- HTTP --> APIServer
                    WSClient -- WebSocket --> APIServer

                    WSClient --> Dashboard
                    WSClient --> Monitor
                </pre>
            </div>
             <div class="slide-number">24/41</div>
        </section>

        <section class="slide">
            <h2>⚙️ C3 Diagram - API Server Components</h2>
            <div class="mermaid-container">
                 <pre><code style="font-size: 0.8em; text-align: left; line-height: 1.2;">
┌─────────────────────────────────────────────────┐
│                API Server                       │
│ ┌─────────────────┐    ┌───────────────────────┐│
│ │ Authentication  │◄──►│   Agent Status        ││
│ │    Service      │    │     Service           ││
│ │• authenticate() │    │• updateStatus()       ││
│ │• validateToken()│    │• getStatusHistory()   ││
│ └─────────────────┘    └───────────────────────┘│
│           │                        │            │
│           │ ┌─────────────────────────────────┐ │
│           └─┤          Event Bus              ├─┘
│             │         Component               │
│             │• publish(event, data)           │
│             │• subscribe(event, handler)      │
│             └─────────────────────────────────┘
│           │                   │                 │
│ ┌─────────────────┐          │  ┌──────────────┐│
│ │   WebSocket     │◄─────────┼─►│   Message    ││
│ │    Manager      │          │  │   Routing    ││
│ │• handleConn()   │          │  │   Service    ││
│ │• broadcast()    │          │  │• routeMsg()  ││
│ └─────────────────┘          │  └──────────────┘│
│           │                  │                  │
│ ┌─────────────────────────────────────────────┐ │
│ │        Database Access Layer                │ │
│ │• executeQuery(sql), insertDocument(doc)     │ │
│ └─────────────────────────────────────────────┘ │
│                           │                     │
│                           ▼ Database Queries    │
└─────────────────────────────────────────────────┘
                </code></pre>
            </div>
             <div class="slide-number">25/40</div>
        </section>

         <section id="slide-24" class="slide">
            <h2>⚙️ C3 Diagram - API Server Components</h2>
            <div class="mermaid-container">
                <pre class="mermaid">
                graph TD
                    subgraph API_Server ["API Server (Node.js)"]
                        Auth[Authentication Service]
                        Status[Agent Status Service]
                        Message[Message Routing Service]
                        WSManager[WebSocket Manager]
                        EventBus[Event Bus]
                        DBLayer[Database Access Layer]
                    end
                    
                    Database((Database Layer))

                    Auth --> DBLayer
                    Status --> DBLayer
                    Message --> DBLayer

                    Auth --> EventBus
                    Status --> EventBus
                    Message --> EventBus
                    
                    EventBus --> WSManager
                    Message --> WSManager
                    DBLayer --> Database
                </pre>
            </div>
             <div class="slide-number">25/41</div>
        </section>

        <section class="slide">
            <h2>🗄️ C3 Diagram - Database Layer Components</h2>
            <div class="mermaid-container">
                 <pre><code style="font-size: 0.8em; text-align: left; line-height: 1.2;">
┌─────────────────────────────────────────────────┐
│                Database Layer                   │
│ ┌─────────────────┐    ┌───────────────────────┐│
│ │     MSSQL       │◄──►│    Data Sync          ││
│ │   Component     │    │   Component           ││
│ │• Agent Master   │    │• syncAgentData()      ││
│ │• User Accounts  │    │• reconcileStatus()    ││
│ └─────────────────┘    └───────────────────────┘│
│           │                        │            │
│           │            ┌───────────────────────┐│
│           └───────────►│     MongoDB           ││
│                        │    Component          ││
│ ┌─────────────────┐    │• Status Logs          ││
│ │ Connection Pool │◄──►│• Message History      ││
│ │    Manager      │    └───────────────────────┘│
│ │• MSSQL Pool     │               │             │
│ │• MongoDB Pool   │    ┌───────────────────────┐│
│ └─────────────────┘◄──►│   Data Security       ││
│                        │    Component          ││
│                        │• encrypt(), decrypt()  ││
│                        └───────────────────────┘│
└─────────────────────────────────────────────────┘
                </code></pre>
            </div>
             <div class="slide-number">26/40</div>
        </section>

     <section id="slide-25" class="slide">
            <h2>🗄️ C3 Diagram - Database Layer Components</h2>
            <div class="mermaid-container">
                <pre class="mermaid">
                graph TD
                    subgraph Database_Layer ["Database Layer"]
                        MSSQL["MSSQL Component<br/>(Master Data)"]
                        MongoDB["MongoDB Component<br/>(Real-time Data)"]
                        Sync[Data Sync Component]
                        Pool[Connection Pool Manager]
                        Security[Data Security Component]
                    end

                    Pool --> MSSQL
                    Pool --> MongoDB
                    Sync --> MSSQL
                    Sync --> MongoDB
                    Security -- wraps --> Pool
                </pre>
            </div>
             <div class="slide-number">26/41</div>
        </section>

        <section class="slide">
            <h2>🔄 Component Interaction Flow</h2>
            <h3>ตัวอย่าง Flow การเปลี่ยนสถานะของ Agent</h3>
            <div class="mermaid-container">
                <pre class="mermaid">
                sequenceDiagram
                    autonumber
                    participant User
                    participant DesktopApp as "Agent Desktop"
                    participant APIServer as "Backend"
                    participant EventBus
                    participant Supervisor as "Supervisor UI"
                    
                    User->>DesktopApp: Change Status to "Busy"
                    DesktopApp->>APIServer: PUT /api/status { status: "Busy" }
                    APIServer->>APIServer: Validate & Update DB
                    APIServer->>EventBus: Publish('status_changed')
                    EventBus-->>APIServer: (to WebSocket Manager)
                    APIServer-->>Supervisor: WebSocket Broadcast
                    Supervisor->>Supervisor: Update Dashboard UI
                    APIServer-->>DesktopApp: HTTP 200 OK
                </pre>
            </div>
            <p><strong>Synchronous Operations:</strong> 1-3, 7 (ต้องการผลทันที) | <strong>Asynchronous Operations:</strong> 4-6 (ทำงานเบื้องหลัง)</p>
             <div class="slide-number">27/40</div>
        </section>

        <section class="slide">
            <h2>📋 Component Dependencies Matrix</h2>
            <h3>การวิเคราะห์การพึ่งพากันใน Backend</h3>
            <table>
                <thead>
                    <tr>
                        <th>Component</th>
                        <th>Auth Svc</th>
                        <th>Status Svc</th>
                        <th>Msg Svc</th>
                        <th>WS Mgr</th>
                        <th>DB Layer</th>
                        <th>Event Bus</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td><strong>Auth Svc</strong></td><td>-</td><td>❌</td><td>❌</td><td>❌</td><td>✅</td><td>✅</td></tr>
                    <tr><td><strong>Status Svc</strong></td><td>✅</td><td>-</td><td>❌</td><td>❌</td><td>✅</td><td>✅</td></tr>
                    <tr><td><strong>Msg Svc</strong></td><td>✅</td><td>❌</td><td>-</td><td>✅</td><td>✅</td><td>✅</td></tr>
                    <tr><td><strong>WS Mgr</strong></td><td>✅</td><td>❌</td><td>❌</td><td>-</td><td>❌</td><td>✅</td></tr>
                </tbody>
            </table>
             <h4>🔍 วิเคราะห์และแนวทางแก้ไข:</h4>
            <ul>
                <li><strong>Event Bus</strong> และ <strong>DB Layer</strong> เป็น Central Dependencies → เป็นเรื่องปกติ แต่ต้องมั่นใจว่ามี Reliability สูง (เช่นใช้ Circuit Breaker, Caching)</li>
                <li><strong>WebSocket Manager</strong> มีหลายส่วนเรียกใช้ → ต้องออกแบบให้รองรับ Load ได้ดี (เช่น Connection Pooling)</li>
                 <li>Service ต่างๆ ไม่เรียกใช้กันโดยตรง → เป็นตัวอย่างที่ดีของ Loose Coupling</li>
            </ul>
             <div class="slide-number">28/40</div>
        </section>

        <section class="slide">
            <h2>🚨 Common Anti-Patterns & Solutions</h2>
            <div class="grid-2">
                <div class="anti-pattern">
                    <h4>❌ God Component</h4>
                    <p>Component ที่ทำทุกอย่าง</p>
                    <div class="solution"><strong>✅ Solution:</strong> แบ่ง Component ตามหลัก Single Responsibility</div>
                </div>
                 <div class="anti-pattern">
                    <h4>❌ Circular Dependencies</h4>
                    <p>A เรียก B, B เรียก A กลับ</p>
                    <div class="solution"><strong>✅ Solution:</strong> ใช้ Event Bus ตัดการเรียกใช้โดยตรง</div>
                </div>
                 <div class="anti-pattern">
                    <h4>❌ Hidden Dependencies</h4>
                    <p>เรียกใช้ Global Variable</p>
                    <div class="solution"><strong>✅ Solution:</strong> ใช้ Dependency Injection</div>
                </div>
                 <div class="anti-pattern">
                    <h4>❌ Tight Coupling</h4>
                    <p>ผูกติดกับ Implementation</p>
                    <div class="solution"><strong>✅ Solution:</strong> พึ่งพา Interface ไม่ใช่ Concrete Class</div>
                </div>
            </div>
             <div class="slide-number">29/40</div>
        </section>

        <section class="slide">
            <h2>✅ Component Design Checklist</h2>
            <h3>รายการตรวจสอบคุณภาพการออกแบบ Components</h3>
            <div class="grid-2">
                <div>
                    <h4>🎯 Single Responsibility & Dependencies</h4>
                     <ul class="checklist">
                        <li>มีเป้าหมายหลักเดียวที่ชัดเจน?</li>
                        <li>Dependencies ถูก inject จากภายนอก?</li>
                        <li>พึ่งพา interfaces ไม่ใช่ concrete classes?</li>
                        <li>ไม่มี circular dependencies?</li>
                    </ul>
                    <h4>🎭 Interface Design & Encapsulation</h4>
                     <ul class="checklist">
                        <li>Interface ชื่อชัดเจน บอกหน้าที่ได้?</li>
                        <li>ซ่อนรายละเอียด implementation?</li>
                        <li>Public interface น้อยที่สุด?</li>
                    </ul>
                </div>
                 <div>
                    <h4>🧪 Testability & Performance</h4>
                     <ul class="checklist">
                        <li>Unit test ได้ง่าย แยกจากส่วนอื่น?</li>
                        <li>Dependencies mock ได้ง่าย?</li>
                        <li>มีการ cache ผลลัพธ์ที่เหมาะสม?</li>
                        <li>ป้องกัน Memory leaks?</li>
                    </ul>
                      <h4>Agent Wallboard Specific</h4>
                     <ul class="checklist">
                        <li>WebSocket มี reconnection logic?</li>
                        <li>Status transitions มี validation?</li>
                        <li>Message delivery มี confirmation?</li>
                    </ul>
                </div>
            </div>
             <div class="slide-number">30/40</div>
        </section>

        <section class="slide">
            <h2>🎯 Component Architecture Summary</h2>
            <div class="grid-2">
                <div>
                     <h4>🏆 Key Principles ที่ได้เรียนรู้:</h4>
                    <ul class="checklist">
                        <li>Component-Based Thinking (SRP)</li>
                        <li>Dependency Management (DI, Loose Coupling)</li>
                        <li>Communication Patterns (Event-Driven, CQRS)</li>
                        <li>Layered Architecture</li>
                    </ul>
                </div>
                <div>
                    <h4>🚀 ก้าวต่อไป:</h4>
                    <p>ในสัปดาห์หน้า เราจะนำ Component Architecture ที่ได้ออกแบบในสัปดาห์นี้ ไปลงรายละเอียดในระดับ Code (C4) ซึ่งรวมถึงการออกแบบ Class Diagram, Sequence Diagram และ API Specification ที่สมบูรณ์</p>
                </div>
            </div>
             <div class="slide-number">31/40</div>
        </section>

        <section class="slide">
            <h2>🛠️ Workshop Activity - สร้าง C3 Component Diagram</h2>
            <h3>กิจกรรมปฏิบัติ: ออกแบบ Component Architecture</h3>
            <div class="grid-2">
                <div>
                     <h4>🎯 วัตถุประสงค์:</h4>
                    <p>เพื่อให้นักศึกษาได้ลงมือปฏิบัติจริงในการสร้าง C3 Component Diagram และออกแบบ Component Interface Specifications</p>
                    <h4>👥 การแบ่งกลุ่ม:</h4>
                    <ul>
                        <li>กลุ่มละ 4-5 คน</li>
                        <li>แต่ละกลุ่มรับผิดชอบคนละ Container (Desktop, API, Dashboard, DB)</li>
                    </ul>
                </div>
                <div>
                    <h4>📋 Tasks:</h4>
                    <ol style="padding-left: 20px;">
                        <li><strong>Phase 1: Component Identification (15 นาที)</strong> - ระบุ Components และหน้าที่</li>
                        <li><strong>Phase 2: Interface Design (20 นาที)</strong> - ออกแบบ Methods และ Dependencies</li>
                        <li><strong>Phase 3: Diagram Creation (25 นาที)</strong> - วาดแผนภาพด้วย Draw.io</li>
                        <li><strong>Phase 4 & 5: Docs & Presentation (20 นาที)</strong> - ทำเอกสารและนำเสนอ</li>
                    </ol>
                </div>
            </div>
             <div class="slide-number">32/40</div>
        </section>

        <section class="slide">
            <h2>📝 Workshop Guidelines และ Templates</h2>
            <div class="grid-2">
                <div>
                    <h4>📋 Component Interface Template:</h4>
                    <pre><code class="language-typescript">
// Component Interface: [ชื่อ Component]
// Responsibility: [หน้าที่ความรับผิดชอบ]
interface IComponentName {
  // Methods
  methodName(param1: Type1): Promise<ReturnType>;
  
  // Properties (ถ้ามี)
  readonly propertyName: Type;
}
</code></pre>
                </div>
                <div>
                    <h4>🎨 Diagram Elements (ตัวอย่าง):</h4>
                     <div class="mermaid-container" style="min-height: auto;">
                        <pre class="mermaid">
                        graph TD
                            A["Component Name"] -- uses --> B["Dependency"]
                            A -- publishes --> C((Event))
                        </pre>
                    </div>
                </div>
            </div>
              <div class="slide-number">33/40</div>
        </section>
        
        <section class="slide">
            <h2>👥 Workshop Execution Plan</h2>
            <h3>แผนการดำเนินกิจกรรม Workshop (90 นาที)</h3>
            
            <ul class="checklist" style="columns: 2; -webkit-columns: 2; -moz-columns: 2;">
                <li>Introduction (10 นาที)</li>
                <li>Analysis (15 นาที)</li>
                <li>Interface Design (20 นาที)</li>
                <li>Diagram Creation (25 นาที)</li>
                <li>Documentation (10 นาที)</li>
                <li>Presentation (10 นาที)</li>
            </ul>
             <div class="slide-number">34/40</div>
        </section>

        <section class="slide">
            <h2>📊 Workshop Assessment Criteria</h2>
            <h3>เกณฑ์การประเมินผลงาน Workshop</h3>
            <table>
                <thead>
                    <tr>
                        <th>เกณฑ์การประเมิน</th>
                        <th>คะแนน</th>
                        <th>รายละเอียด</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Component Diagram Quality</strong></td>
                        <td>40%</td>
                        <td>ความชัดเจน, ความถูกต้อง, ความสมบูรณ์, การใช้สัญลักษณ์มาตรฐาน</td>
                    </tr>
                    <tr>
                        <td><strong>Interface Design</strong></td>
                        <td>30%</td>
                        <td>ความชัดเจนของ Interface, ความเหมาะสมของ Method, การจัดการ Error</td>
                    </tr>
                    <tr>
                        <td><strong>Dependencies Analysis</strong></td>
                        <td>20%</td>
                        <td>ความถูกต้องของการระบุ Dependencies, การหลีกเลี่ยง Anti-patterns</td>
                    </tr>
                    <tr>
                        <td><strong>Teamwork & Presentation</strong></td>
                        <td>10%</td>
                        <td>การทำงานร่วมกัน, ความชัดเจนในการนำเสนอ, การตอบคำถาม</td>
                    </tr>
                </tbody>
            </table>
             <div class="slide-number">35/40</div>
        </section>

        <section class="slide">
            <h2>📝 Assignment - Complete Component Architecture Design</h2>
            <h3>งานที่มอบหมาย: การออกแบบ Component Architecture แบบสมบูรณ์</h3>
            
            <h4>📋 รายละเอียดงาน:</h4>
            <p>ให้นักศึกษานำความรู้ที่ได้จากในห้องเรียนและ Workshop มาสร้างเอกสาร <strong>"Complete Component Architecture Design"</strong> สำหรับโปรเจกต์ Agent Wallboard System ทั้งระบบ</p>
            
            <h4>ส่วนประกอบของงานที่ต้องส่ง (PDF 8-12 หน้า):</h4>
            <ol style="padding-left:20px;">
                <li><strong>System-wide Component Diagram (40%):</strong> C3 Diagram ที่แสดง Components ทั้งหมดในทุก Container และความสัมพันธ์ระหว่างกัน</li>
                <li><strong>Interface Specifications (35%):</strong> เอกสารอธิบาย Interface ของ Components ที่สำคัญอย่างน้อย 5 ตัว พร้อมตัวอย่างโค้ด</li>
                <li><strong>Architecture Analysis (25%):</strong> การวิเคราะห์ Dependencies, Bottlenecks ที่อาจเกิดขึ้น และการพิจารณาด้านคุณภาพอื่นๆ (Security, Performance)</li>
            </ol>

            <p><strong>กำหนดส่ง:</strong> ก่อนคาบเรียนสัปดาห์ที่ 8</p>
             <div class="slide-number">36/40</div>
        </section>
        
        <section class="slide">
            <h2>🔍 Architecture Review Process</h2>
            <h3>กระบวนการทบทวนและวิจารณ์ Architecture Design</h3>
            <p>การออกแบบที่ดีเกิดจากการทบทวนและปรับปรุงอย่างต่อเนื่อง</p>
            
            <h4>📋 Review Checklist:</h4>
            <ul class="checklist" style="columns: 2;">
                <li>Component Structure? (SRP)</li>
                <li>Communication Flow? (Data Flow)</li>
                <li>Dependencies Correct? (No Circular)</li>
                <li>Quality Attributes? (Security, Perf)</li>
            </ul>
            
            <h4>👥 Peer Review Process:</h4>
            <p>ให้นักศึกษาจับคู่แลกเปลี่ยนงาน Assignment ที่ทำเสร็จแล้วเพื่อทำการ Peer Review โดยใช้ Checklist ข้างต้นเป็นแนวทางในการให้ Feedback ที่สร้างสรรค์</p>
             <div class="slide-number">37/40</div>
        </section>
        
        <section class="slide">
            <h2>🚀 Next Week Preparation</h2>
            <h3>เตรียมความพร้อมสำหรับสัปดาห์ที่ 8</h3>

            <h4>📅 สัปดาห์ที่ 8: การออกแบบสถาปัตยกรรมซอฟต์แวร์ - ขั้นสูง</h4>
            <p>เราจะนำ Component Architecture ที่เราสร้างขึ้น มาลงลึกในรายละเอียดระดับ Code (C4-code) เพื่อเตรียมพร้อมสำหรับการ Implementation</p>

            <h4>📚 หัวข้อที่จะเรียน:</h4>
            <ul style="columns: 2;">
                <li>C4 Model Level 4 (Code)</li>
                <li>UML: Sequence & Activity Diagrams</li>
                <li>API Specifications (Swagger/OpenAPI)</li>
                <li>Database Design & Schema</li>
            </ul>
            
            <h4>🔧 สิ่งที่ต้องเตรียม:</h4>
            <ul>
                <li>ติดตั้งโปรแกรม: <strong>PlantUML, Swagger Editor, Postman</strong></li>
                <li>ทบทวนความรู้: <strong>UML Basics, REST API, Database Normalization</strong></li>
            </ul>
             <div class="slide-number">38/40</div>
        </section>

        <section class="slide">
            <h2>📊 Component Architecture Assessment Summary</h2>
            <h3>สรุปการประเมินผลและเป้าหมายการเรียนรู้</h3>
            
            <div class="grid-2">
                <div>
                     <h4>✅ วัตถุประสงค์ที่บรรลุในสัปดาห์นี้:</h4>
                    <ul class="checklist">
                        <li>เข้าใจ Component-based Arch</li>
                        <li>สร้าง C3 Component Diagram ได้</li>
                        <li>ออกแบบ Component Interfaces ได้</li>
                        <li>เข้าใจ Communication Patterns</li>
                    </ul>
                </div>
                <div>
                    <h4>🚀 เป้าหมายที่จะต่อยอดในสัปดาห์หน้า:</h4>
                    <ul class="checklist">
                        <li>สร้าง Implementation-ready Design (C4)</li>
                        <li>ออกแบบ Database Schema</li>
                        <li>เขียน API Specifications</li>
                        <li>สร้างเอกสารทางเทคนิคที่สมบูรณ์</li>
                    </ul>
                </div>
            </div>
             <div class="slide-number">39/40</div>
        </section>

        <section class="slide">
            <h2>🎓 Skills Development Progress</h2>
            <h3>การพัฒนาทักษะและความสามารถ</h3>

            <h4>📊 ทักษะที่ได้พัฒนาในสัปดาห์นี้:</h4>
             <ul class="checklist" style="columns: 2;">
                <li>Technical Architecture</li>
                <li>Design & Modeling (C4)</li>
                <li>Collaboration & Communication</li>
                <li>Problem-Solving & Critical Thinking</li>
                <li>Technical Writing</li>
                <li>Peer Review & Feedback</li>
            </ul>
            <p style="text-align: center; margin-top:20px;">ทักษะเหล่านี้เป็นพื้นฐานที่สำคัญอย่างยิ่งสำหรับตำแหน่ง <strong>Software Architect</strong> และ <strong>Senior Software Engineer</strong> ในอนาคต</p>
             <div class="slide-number">40/40</div>
        </section>
        
        <section class="slide">
            <h2>🎬 สรุปสัปดาห์ที่ 7 และ Looking Forward</h2>
            <h3>บทสรุปและการเตรียมตัวสำหรับสัปดาห์หน้า</h3>

            <h4>🏆 สรุปการเรียนรู้สัปดาห์ที่ 7:</h4>
            <p>เราได้เดินทางจาก High-level Architecture ในสัปดาห์ก่อน มาสู่การออกแบบ <strong>Component Architecture</strong> ที่เป็นรูปธรรมและจับต้องได้มากขึ้น เราได้เรียนรู้หลักการสำคัญ, รูปแบบการสื่อสาร, และได้ลงมือปฏิบัติจริงในการสร้าง C3 Diagram ซึ่งเป็นสะพานเชื่อมที่สำคัญระหว่าง "สถาปัตยกรรม" และ "โค้ด"</p>

            <blockquote>การออกแบบ Component ที่ดี คือหัวใจของการสร้างซอฟต์แวร์ที่ยืดหยุ่น, บำรุงรักษาง่าย, และสามารถเติบโตไปพร้อมกับความต้องการทางธุรกิจได้</blockquote>
            
            <h4>🚀 Roadmap to Success:</h4>
            <ol style="padding-left:20px;">
                <li><strong>ทบทวนเนื้อหา:</strong> กลับไปทบทวนหลักการ High Cohesion, Loose Coupling และ DI</li>
                <li><strong>ทำงานที่ได้รับมอบหมาย:</strong> ตั้งใจทำ Assignment การออกแบบ Component Architecture ให้ดีที่สุด</li>
                <li><strong>เตรียมตัวสำหรับสัปดาห์หน้า:</strong> ศึกษาเรื่อง UML Sequence Diagram และ REST API มาล่วงหน้า</li>
            </ol>
             <div class="slide-number">41/40</div>
        </section>
    </div>

    <div class="presentation-controls">
        <button id="prev-btn" class="nav-btn" title="สไลด์ก่อนหน้า">‹</button>
        <span id="slide-counter"></span>
        <button id="next-btn" class="nav-btn" title="สไลด์ถัดไป">›</button>
        <button id="font-decrease-btn" class="font-btn" title="ลดขนาดตัวอักษร">-</button>
        <button id="font-increase-btn" class="font-btn" title="เพิ่มขนาดตัวอักษร">+</button>
        <button id="fullscreen-btn" class="fullscreen-btn" title="เต็มจอ">⛶</button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // This script block remains for general slide controls
            
            const slides = document.querySelectorAll('.slide');
            const nextBtn = document.getElementById('next-btn');
            const prevBtn = document.getElementById('prev-btn');
            const fullscreenBtn = document.getElementById('fullscreen-btn');
            const slideCounter = document.getElementById('slide-counter');
            const progressBar = document.getElementById('progress-bar');
            const fontIncreaseBtn = document.getElementById('font-increase-btn');
            const fontDecreaseBtn = document.getElementById('font-decrease-btn');
            const root = document.documentElement;

            let currentFontSize = 1.5; 
            let currentSlideIndex = 0;
            const totalSlides = slides.length;

            function updateFontSize() {
                root.style.setProperty('--base-font-size', `clamp(16px, ${currentFontSize}vw, 24px)`);
            }
            
            function showSlide(index) {
                if (index < 0 || index >= totalSlides) return;

                slides.forEach((slide, i) => {
                    slide.classList.toggle('active', i === index);
                });

                const activeSlide = slides[index];

                if (activeSlide.scrollTop > 0) {
                    activeSlide.scrollTop = 0;
                }
                
                // Manually render Mermaid diagrams on the active slide if not already rendered
                if (window.mermaid && !activeSlide.dataset.mermaidRendered) {
                    const mermaidElements = activeSlide.querySelectorAll('pre.mermaid');
                    if (mermaidElements.length > 0) {
                        try {
                           window.mermaid.run({ nodes: mermaidElements });
                           activeSlide.dataset.mermaidRendered = 'true';
                        } catch (e) {
                           console.error("Mermaid rendering failed:", e);
                        }
                    }
                }

                currentSlideIndex = index;
                updateControls();
            }

            function updateControls() {
                slideCounter.textContent = `${currentSlideIndex + 1} / ${totalSlides}`;
                const progressPercentage = ((currentSlideIndex + 1) / totalSlides) * 100;
                progressBar.style.width = `${progressPercentage}%`;
                prevBtn.disabled = currentSlideIndex === 0;
                nextBtn.disabled = currentSlideIndex === totalSlides - 1;
            }

            function toggleFullscreen() {
                if (!document.fullscreenElement) {
                    document.documentElement.requestFullscreen().catch(err => {
                        alert(`ไม่สามารถเข้าสู่โหมดเต็มจอได้: ${err.message}`);
                    });
                } else {
                    if (document.exitFullscreen) {
                        document.exitFullscreen();
                    }
                }
            }

            fontIncreaseBtn.addEventListener('click', () => {
                if (currentFontSize < 2.5) {
                    currentFontSize += 0.1;
                    updateFontSize();
                }
            });

            fontDecreaseBtn.addEventListener('click', () => {
                if (currentFontSize > 0.8) {
                    currentFontSize -= 0.1;
                    updateFontSize();
                }
            });

            nextBtn.addEventListener('click', () => showSlide(currentSlideIndex + 1));
            prevBtn.addEventListener('click', () => showSlide(currentSlideIndex - 1));
            fullscreenBtn.addEventListener('click', toggleFullscreen);

            document.addEventListener('keydown', (event) => {
                if (event.target.tagName === 'INPUT' || event.target.tagName === 'TEXTAREA') return;

                if (event.key === 'ArrowRight' || event.key === ' ') {
                    event.preventDefault();
                    nextBtn.click();
                } else if (event.key === 'ArrowLeft') {
                    event.preventDefault();
                    prevBtn.click();
                } else if (event.key === 'f') {
                    event.preventDefault();
                    toggleFullscreen();
                }
            });

            showSlide(0); // Show the first slide initially
        });
    </script>
</body>
</html>