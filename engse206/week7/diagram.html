<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>Mermaid Fixed Example</title>
  <script type="module">
    // import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
    // mermaid.initialize({ startOnLoad: true });
      import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
  mermaid.initialize({
    startOnLoad: true,
    flowchart: { htmlLabels: true }  // <- เปิดให้ใช้ <br/> ใน label
  });
  </script>
</head>
<body>
  <h1>Mermaid Diagram Fixed</h1>

  <!-- Diagram 1 -->
  <pre class="mermaid">
graph TD
C1["System Context"] --> C2["Containers"]
C2 --> C3["Components"]
C3 --> C4["Code"]
style C3 fill:#D4A237,stroke:#333,stroke-width:2px
  </pre>

  <!-- Diagram 2 -->
  <pre class="mermaid">
graph TD
A[Frontend Components] -->|HTTP / WebSocket| B[Backend API Components]
B -->|Database Queries| C[Data Tier Components]
  </pre>

  <!-- Diagram 3 -->
  <pre class="mermaid">
graph TD
A[Agent เปลี่ยนสถานะ] --> B[Agent Status Service]
B --> C[อัพเดทฐานข้อมูล]
C --> D[ประกาศ Event status_changed]
D --> E[Event Bus]
E --> F[Dashboard Component]
E --> G[Notification Service]
E --> H[WebSocket Manager]

  </pre>

  <!-- Diagram 4 -->
  <pre class="mermaid">
graph TD
subgraph Clients
  A[Mobile App]
  B[Web App]
end
subgraph Backend_Services
  S1[Service 1]
  S2[Service 2]
  S3[Service 3]
end
GW[API Gateway]
A --> GW
B --> GW
GW --> S1
GW --> S2
GW --> S3
  </pre>

  <!-- Diagram 5 -->
  <pre class="mermaid">
graph TD
subgraph Desktop_Application["Desktop Application (Electron.js)"]
  Auth[Authentication Component]
  Status[Status Management]
  Notify[Notification Component]
  WSClient[WebSocket Client]
  Profile[Profile Component]
end

APIServer((API Server))

Auth -- HTTP --> APIServer
Status -- HTTP --> APIServer
Profile -- HTTP --> APIServer
WSClient -- WebSocket --> APIServer

WSClient <--> Notify
Auth --- Status
  </pre>

  <!-- Diagram 6 -->
  <pre class="mermaid">
graph TD
subgraph Supervisor_Dashboard["Supervisor Dashboard (Web)"]
  Dashboard[Dashboard Visualization]
  Monitor[Agent Monitor]
  Messaging[Message Management]
  Reports[Reports Component]
  WSClient[WebSocket Client]
end

APIServer((API Server))

Dashboard -- HTTP --> APIServer
Monitor -- HTTP --> APIServer
Messaging -- HTTP --> APIServer
Reports -- HTTP --> APIServer
WSClient -- WebSocket --> APIServer

WSClient --> Dashboard
WSClient --> Monitor
  </pre>

  <!-- Diagram 7 -->
  <pre class="mermaid">
graph TD
subgraph API_Server["API Server (Node.js)"]
  Auth[Authentication Service]
  Status[Agent Status Service]
  Message[Message Routing Service]
  WSManager[WebSocket Manager]
  EventBus[Event Bus]
  DBLayer[Database Access Layer]
end

Database((Database Layer))

Auth --> DBLayer
Status --> DBLayer
Message --> DBLayer

Auth --> EventBus
Status --> EventBus
Message --> EventBus

EventBus --> WSManager
Message --> WSManager
DBLayer --> Database
  </pre>

  <!-- Diagram 8 -->
  <pre class="mermaid">
graph TD
subgraph Database_Layer["Database Layer"]
  MSSQL["MSSQL Component\n(Master Data)"]
  MongoDB["MongoDB Component\n(Real-time Data)"]
  Sync[Data Sync Component]
  Pool[Connection Pool Manager]
  Security[Data Security Component]
end

Pool --> MSSQL
Pool --> MongoDB
Sync --> MSSQL
Sync --> MongoDB
Security -- wraps --> Pool
  </pre>

  <!-- Diagram 9 -->
  <pre class="mermaid">
sequenceDiagram
  participant User
  participant DesktopApp as "Agent Desktop"
  participant APIServer as "Backend"
  participant DB as "Database"
  participant Supervisor as "Supervisor"

  User->>DesktopApp: Change Status
  DesktopApp->>APIServer: PUT /api/agents/status
  APIServer->>APIServer: Validate Token & Logic
  APIServer->>DB: Update Status & Log
  DB-->>APIServer: Success
  APIServer-->>Supervisor: WebSocket Broadcast
  Supervisor->>Supervisor: Update Dashboard UI
  APIServer-->>DesktopApp: HTTP 200 OK
  </pre>

<!-- Corrected Diagram 10 -->
<!-- Corrected Diagram 10 -->
<pre class="mermaid">
graph TD
  A["Component Name - Responsibility"]
  B1["publicMethod1()"]
  C1["publicMethod2()"]

  A --> B1
  A --> C1
</pre>


</body>
</html>
